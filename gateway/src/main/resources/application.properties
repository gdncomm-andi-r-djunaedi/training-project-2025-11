# =====================================================
# API GATEWAY CONFIGURATION
# =====================================================

# Server Configuration
server.port=8083
spring.application.name=api-gateway

# =====================================================
# JWT CONFIGURATION
# =====================================================
jwt.secret=70d9a400-3fd5-4501-9abe-2acf1761f396
jwt.expiration=3600

# =====================================================
# REDIS CONFIGURATION - for Rate Limiting
# =====================================================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.timeout=2000ms

# =====================================================
# SPRING CLOUD GATEWAY CONFIGURATION
# =====================================================
spring.cloud.gateway.server.webflux.enabled=true

# =====================================================
# CORS CONFIGURATION
# =====================================================
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedOrigins[0]=http://localhost:3000
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedOrigins[1]=http://localhost:8080
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedOrigins[2]=http://localhost:4200
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[0]=GET
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[1]=POST
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[2]=PUT
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[3]=DELETE
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[4]=PATCH
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedMethods[5]=OPTIONS
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedHeaders[0]=Authorization
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedHeaders[1]=Content-Type
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedHeaders[2]=X-Requested-With
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedHeaders[3]=X-User-Id
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowedHeaders[4]=X-Username
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].exposedHeaders[0]=X-User-Id
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].exposedHeaders[1]=X-Username
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.cors.cors-configurations.[/**].maxAge=3600

# =====================================================
# GATEWAY PUBLIC PATHS (No JWT Required)
# =====================================================
gateway.public-paths=/api/auth/**,/actuator/**,/health

# =====================================================
# ROUTE CONFIGURATION
# =====================================================

# Route 1: Member Service (Auth endpoints - public)
spring.cloud.gateway.server.webflux.routes[0].id=member-service
spring.cloud.gateway.server.webflux.routes[0].uri=http://localhost:8080
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=StripPrefix=1
spring.cloud.gateway.server.webflux.routes[0].filters[1].name=RequestRateLimiter
spring.cloud.gateway.server.webflux.routes[0].filters[1].args.redis-rate-limiter.replenishRate=10
spring.cloud.gateway.server.webflux.routes[0].filters[1].args.redis-rate-limiter.burstCapacity=20
spring.cloud.gateway.server.webflux.routes[0].filters[1].args.redis-rate-limiter.requestedTokens=1

# Route 2: Member Service (Protected endpoints - JWT required)
spring.cloud.gateway.server.webflux.routes[1].id=member-service-protected
spring.cloud.gateway.server.webflux.routes[1].uri=http://localhost:8080
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/member/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=StripPrefix=1
spring.cloud.gateway.server.webflux.routes[1].filters[1].name=RequestRateLimiter
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.redis-rate-limiter.replenishRate=5
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.redis-rate-limiter.burstCapacity=10
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.redis-rate-limiter.requestedTokens=1

# Route 3: User Service (if exists - JWT required)
# spring.cloud.gateway.server.webflux.routes[2].id=user-service
# spring.cloud.gateway.server.webflux.routes[2].uri=http://localhost:8082
# spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/users/**
# spring.cloud.gateway.server.webflux.routes[2].filters[0]=StripPrefix=1
# spring.cloud.gateway.server.webflux.routes[2].filters[1].name=RequestRateLimiter
# spring.cloud.gateway.server.webflux.routes[2].filters[1].args.redis-rate-limiter.replenishRate=5
# spring.cloud.gateway.server.webflux.routes[2].filters[1].args.redis-rate-limiter.burstCapacity=10
# spring.cloud.gateway.server.webflux.routes[2].filters[1].args.redis-rate-limiter.requestedTokens=1

# Route 4: Product Service (if exists - JWT required)
 spring.cloud.gateway.server.webflux.routes[3].id=product-service
 spring.cloud.gateway.server.webflux.routes[3].uri=http://localhost:8082
 spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/products/**
 spring.cloud.gateway.server.webflux.routes[3].filters[0]=StripPrefix=1
 spring.cloud.gateway.server.webflux.routes[3].filters[1].name=RequestRateLimiter
 spring.cloud.gateway.server.webflux.routes[3].filters[1].args.redis-rate-limiter.replenishRate=20
 spring.cloud.gateway.server.webflux.routes[3].filters[1].args.redis-rate-limiter.burstCapacity=40
 spring.cloud.gateway.server.webflux.routes[3].filters[1].args.redis-rate-limiter.requestedTokens=1

# =====================================================
# HTTP CLIENT CONFIGURATION
# =====================================================
spring.cloud.gateway.server.webflux.httpclient.connect-timeout=1000
spring.cloud.gateway.server.webflux.httpclient.response-timeout=5s
spring.cloud.gateway.server.webflux.httpclient.pool.type=elastic
spring.cloud.gateway.server.webflux.httpclient.pool.max-idle-time=30s

# =====================================================
# LOGGING CONFIGURATION
# =====================================================
logging.level.org.springframework.cloud.gateway=INFO
logging.level.com.project.gateway=DEBUG
logging.level.reactor.netty=INFO

# =====================================================
# ACTUATOR CONFIGURATION
# =====================================================
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.health.show-details=when-authorized

