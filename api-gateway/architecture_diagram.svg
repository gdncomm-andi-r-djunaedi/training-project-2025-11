<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000" style="background-color: #f5f5f5;">
  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#2c3e50">Microservices Architecture - API Gateway System</text>
  
  <!-- Client -->
  <rect x="50" y="80" width="150" height="80" rx="10" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
  <text x="125" y="110" text-anchor="middle" font-size="14" font-weight="bold" fill="white">CLIENT</text>
  <text x="125" y="130" text-anchor="middle" font-size="11" fill="white">Browser/Postman</text>
  <text x="125" y="145" text-anchor="middle" font-size="11" fill="white">Mobile App</text>
  
  <!-- API Gateway -->
  <rect x="300" y="60" width="200" height="400" rx="10" fill="#9b59b6" stroke="#8e44ad" stroke-width="3"/>
  <text x="400" y="85" text-anchor="middle" font-size="16" font-weight="bold" fill="white">API GATEWAY</text>
  <text x="400" y="105" text-anchor="middle" font-size="12" fill="white">Port 8999</text>
  
  <!-- Gateway Components -->
  <rect x="320" y="120" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="140" text-anchor="middle" font-size="10" fill="white">SecurityConfig</text>
  
  <rect x="320" y="160" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="180" text-anchor="middle" font-size="10" fill="white">JwtFilter</text>
  
  <rect x="320" y="200" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="220" text-anchor="middle" font-size="10" fill="white">CartUserIdGatewayFilter</text>
  
  <rect x="320" y="240" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="260" text-anchor="middle" font-size="10" fill="white">AuthController</text>
  
  <rect x="320" y="280" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="300" text-anchor="middle" font-size="10" fill="white">LogInFeign</text>
  
  <rect x="320" y="320" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="340" text-anchor="middle" font-size="10" fill="white">JWTService</text>
  
  <rect x="320" y="360" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="380" text-anchor="middle" font-size="10" fill="white">Gateway Router</text>
  
  <rect x="320" y="400" width="160" height="30" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="1"/>
  <text x="400" y="420" text-anchor="middle" font-size="10" fill="white">Routes Config</text>
  
  <!-- Member Service -->
  <rect x="600" y="80" width="180" height="120" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="690" y="105" text-anchor="middle" font-size="14" font-weight="bold" fill="white">MEMBER SERVICE</text>
  <text x="690" y="125" text-anchor="middle" font-size="11" fill="white">Port 8081</text>
  <rect x="610" y="140" width="160" height="50" rx="5" fill="#2980b9" stroke="#1f618d" stroke-width="1"/>
  <text x="690" y="160" text-anchor="middle" font-size="10" fill="white">Member API</text>
  <text x="690" y="175" text-anchor="middle" font-size="9" fill="white">- Register</text>
  <text x="690" y="188" text-anchor="middle" font-size="9" fill="white">- Login Validation</text>
  
  <!-- Member Database -->
  <rect x="620" y="210" width="140" height="50" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="690" y="230" text-anchor="middle" font-size="11" font-weight="bold" fill="white">PostgreSQL</text>
  <text x="690" y="250" text-anchor="middle" font-size="9" fill="white">Member Database</text>
  <line x1="690" y1="210" x2="690" y2="200" stroke="#c0392b" stroke-width="2"/>
  
  <!-- Product Service -->
  <rect x="600" y="320" width="180" height="120" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="690" y="345" text-anchor="middle" font-size="14" font-weight="bold" fill="white">PRODUCT SERVICE</text>
  <text x="690" y="365" text-anchor="middle" font-size="11" fill="white">Port 8004</text>
  <rect x="610" y="380" width="160" height="50" rx="5" fill="#2980b9" stroke="#1f618d" stroke-width="1"/>
  <text x="690" y="400" text-anchor="middle" font-size="10" fill="white">Product API</text>
  <text x="690" y="415" text-anchor="middle" font-size="9" fill="white">- Get Products</text>
  <text x="690" y="428" text-anchor="middle" font-size="9" fill="white">- Update Products</text>
  
  <!-- Product Database -->
  <rect x="620" y="450" width="140" height="50" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="690" y="470" text-anchor="middle" font-size="11" font-weight="bold" fill="white">PostgreSQL</text>
  <text x="690" y="490" text-anchor="middle" font-size="9" fill="white">Product Database</text>
  <line x1="690" y1="450" x2="690" y2="440" stroke="#c0392b" stroke-width="2"/>
  
  <!-- Cart Service -->
  <rect x="600" y="560" width="180" height="120" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="690" y="585" text-anchor="middle" font-size="14" font-weight="bold" fill="white">CART SERVICE</text>
  <text x="690" y="605" text-anchor="middle" font-size="11" fill="white">Port 8085</text>
  <rect x="610" y="620" width="160" height="50" rx="5" fill="#2980b9" stroke="#1f618d" stroke-width="1"/>
  <text x="690" y="640" text-anchor="middle" font-size="10" fill="white">Cart API</text>
  <text x="690" y="655" text-anchor="middle" font-size="9" fill="white">- Add Items</text>
  <text x="690" y="668" text-anchor="middle" font-size="9" fill="white">- Get Cart (X-User-Id)</text>
  
  <!-- Cart Database -->
  <rect x="620" y="690" width="140" height="50" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="690" y="710" text-anchor="middle" font-size="11" font-weight="bold" fill="white">MongoDB</text>
  <text x="690" y="730" text-anchor="middle" font-size="9" fill="white">Cart Database</text>
  <line x1="690" y1="690" x2="690" y2="680" stroke="#c0392b" stroke-width="2"/>
  
  <!-- Search Service -->
  <rect x="900" y="320" width="180" height="120" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="990" y="345" text-anchor="middle" font-size="14" font-weight="bold" fill="white">SEARCH SERVICE</text>
  <rect x="910" y="380" width="160" height="50" rx="5" fill="#2980b9" stroke="#1f618d" stroke-width="1"/>
  <text x="990" y="400" text-anchor="middle" font-size="10" fill="white">Search API</text>
  <text x="990" y="415" text-anchor="middle" font-size="9" fill="white">- Elasticsearch</text>
  <text x="990" y="428" text-anchor="middle" font-size="9" fill="white">- Index Products</text>
  
  <!-- Elasticsearch -->
  <rect x="920" y="450" width="140" height="50" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="990" y="470" text-anchor="middle" font-size="11" font-weight="bold" fill="white">Elasticsearch</text>
  <text x="990" y="490" text-anchor="middle" font-size="9" fill="white">Search Index</text>
  <line x1="990" y1="450" x2="990" y2="440" stroke="#c0392b" stroke-width="2"/>
  
  <!-- Kafka -->
  <rect x="900" y="560" width="180" height="80" rx="10" fill="#f39c12" stroke="#d68910" stroke-width="2"/>
  <text x="990" y="585" text-anchor="middle" font-size="14" font-weight="bold" fill="white">KAFKA</text>
  <text x="990" y="605" text-anchor="middle" font-size="11" fill="white">Message Broker</text>
  <text x="990" y="625" text-anchor="middle" font-size="10" fill="white">Event Streaming</text>
  
  <!-- Arrows: Client to Gateway -->
  <path d="M 200 120 L 300 260" stroke="#e74c3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="240" y="185" font-size="9" fill="#e74c3c">1. Register</text>
  
  <path d="M 200 120 L 300 280" stroke="#e74c3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="240" y="195" font-size="9" fill="#e74c3c">2. Login</text>
  
  <path d="M 200 120 L 300 360" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="240" y="235" font-size="9" fill="#3498db">3. Products</text>
  
  <path d="M 200 120 L 300 200" stroke="#9b59b6" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="240" y="155" font-size="9" fill="#9b59b6">4. Cart (Token)</text>
  
  <!-- Arrows: Gateway to Member Service -->
  <path d="M 500 140 L 600 140" stroke="#e74c3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="540" y="135" font-size="9" fill="#e74c3c">Register</text>
  
  <path d="M 500 300 L 600 140" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="540" y="215" font-size="9" fill="#3498db">Feign Call</text>
  <text x="540" y="228" font-size="9" fill="#3498db">Login Validate</text>
  
  <!-- Arrows: Member Service to Database -->
  <path d="M 690 200 L 690 210" stroke="#c0392b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrows: Gateway to Product Service -->
  <path d="M 500 400 L 600 400" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="540" y="395" font-size="9" fill="#3498db">Route Products</text>
  
  <!-- Arrows: Product Service to Database -->
  <path d="M 690 440 L 690 450" stroke="#c0392b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrows: Product to Kafka -->
  <path d="M 780 400 L 900 600" stroke="#f39c12" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="840" y="500" font-size="9" fill="#f39c12">Publish Events</text>
  
  <!-- Arrows: Kafka to Search -->
  <path d="M 990 600 L 990 440" stroke="#f39c12" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="1000" y="520" font-size="9" fill="#f39c12">Consume</text>
  
  <!-- Arrows: Search to Elasticsearch -->
  <path d="M 990 440 L 990 450" stroke="#c0392b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrows: Gateway to Cart Service -->
  <path d="M 500 640 L 600 640" stroke="#9b59b6" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="540" y="635" font-size="9" fill="#9b59b6">X-User-Id Header</text>
  
  <!-- Arrows: Cart Service to Database -->
  <path d="M 690 680 L 690 690" stroke="#c0392b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrows: Cart to Product (Feign) -->
  <path d="M 600 640 L 600 400" stroke="#3498db" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="580" y="520" font-size="9" fill="#3498db">Feign Call</text>
  
  <!-- Flow Labels -->
  <rect x="50" y="750" width="1300" height="200" rx="10" fill="white" stroke="#34495e" stroke-width="2"/>
  <text x="700" y="775" text-anchor="middle" font-size="16" font-weight="bold" fill="#2c3e50">Request Flows</text>
  
  <!-- Flow 1: Registration -->
  <text x="100" y="800" font-size="12" font-weight="bold" fill="#2c3e50">1. Registration:</text>
  <text x="100" y="820" font-size="10" fill="#2c3e50">Client → Gateway → Member Service → PostgreSQL</text>
  <text x="100" y="835" font-size="9" fill="#7f8c8d">No authentication required</text>
  
  <!-- Flow 2: Login -->
  <text x="100" y="860" font-size="12" font-weight="bold" fill="#2c3e50">2. Login:</text>
  <text x="100" y="880" font-size="10" fill="#2c3e50">Client → Gateway → Feign → Member Service → JWT Generation → Client</text>
  <text x="100" y="895" font-size="9" fill="#7f8c8d">Validates credentials, generates token</text>
  
  <!-- Flow 3: Products -->
  <text x="100" y="920" font-size="12" font-weight="bold" fill="#2c3e50">3. Product Access:</text>
  <text x="100" y="940" font-size="10" fill="#2c3e50">Client → Gateway → Product Service → PostgreSQL</text>
  
  <!-- Flow 4: Product Update -->
  <text x="600" y="800" font-size="12" font-weight="bold" fill="#2c3e50">4. Product Update:</text>
  <text x="600" y="820" font-size="10" fill="#2c3e50">Product Service → Kafka → Search Service → Elasticsearch</text>
  <text x="600" y="835" font-size="9" fill="#7f8c8d">Asynchronous event streaming</text>
  
  <!-- Flow 5: Cart Access -->
  <text x="600" y="860" font-size="12" font-weight="bold" fill="#2c3e50">5. Cart Access:</text>
  <text x="600" y="880" font-size="10" fill="#2c3e50">Client → Gateway → JWT Validation → Extract userId → Cart Service</text>
  <text x="600" y="895" font-size="9" fill="#7f8c8d">X-User-Id header injected</text>
  
  <!-- Flow 6: Cart to Product -->
  <text x="600" y="920" font-size="12" font-weight="bold" fill="#2c3e50">6. Cart → Product:</text>
  <text x="600" y="940" font-size="10" fill="#2c3e50">Cart Service → Feign Call → Product Service</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
  </defs>
</svg>





