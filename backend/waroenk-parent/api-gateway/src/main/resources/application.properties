# ===========================================
# Application Info
# ===========================================
info.app.version=@project.version@
spring.application.name=@project.artifactId@

# ===========================================
# Server Configuration
# ===========================================
server.port=${HTTP_REST_PORT:8080}
# Tomcat thread pool (tune for your workload)
server.tomcat.threads.max=100
server.tomcat.threads.min-spare=10
server.tomcat.accept-count=100
server.tomcat.connection-timeout=10000

# ===========================================
# Logging (reduce verbosity for stability)
# ===========================================
logging.level.root=WARN
logging.level.com.gdn.project.waroenk.gateway=INFO
logging.level.io.grpc=WARN
logging.level.io.netty=WARN
logging.level.org.hibernate=WARN
logging.level.org.springframework=WARN
logging.level.org.springframework.web=INFO

# ===========================================
# gRPC Server Configuration (for service registration)
# ===========================================
grpc.server.port=${GRPC_SERVER_PORT:6565}
grpc.server.address=0.0.0.0

# ===========================================
# Swagger/OpenAPI Configuration
# ===========================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

# ===========================================
# Actuator Configuration
# ===========================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# ===========================================
# PostgreSQL Configuration (Service Registry)
# ===========================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://${DB_HOSTS:localhost:5432}/${DB_NAME:gatewaydb}?currentSchema=${DB_SCHEMA:public}
spring.datasource.username=${DB_USERNAME:admin}
spring.datasource.password=${DB_PASSWORD:admin}

# HikariCP Connection Pool (CRITICAL for stability)
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA Configuration
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false

# Flyway Configuration
spring.flyway.enabled=${MIGRATE_DATABASE:true}
spring.flyway.lock-retry-count=10
spring.flyway.baseline-on-migrate=true

# ===========================================
# Redis Configuration (Route Cache)
# ===========================================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.password=${REDIS_PASSWORD:}

# Lettuce client pool config (optimized)
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=4
spring.data.redis.lettuce.pool.min-idle=1
spring.data.redis.lettuce.pool.max-wait=2000ms
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.shutdown-timeout=200ms

# ===========================================
# JWT Configuration
# ===========================================
gateway.jwt.secret=${JWT_SECRET:c2VjdXJlLXNlY3JldC1rZXktZm9yLWp3dC10b2tlbi1nZW5lcmF0aW9uLW1pbmltdW0tMjU2LWJpdHM=}
gateway.jwt.access-token-expiration=3600
gateway.jwt.refresh-token-expiration=604800

# ===========================================
# gRPC Service Endpoints (Static/Fallback)
# These are used if services haven't registered dynamically
# Note: These are gRPC ports, NOT HTTP ports
# Default gRPC ports: member=9090, catalog=9091, cart=9092
# If running locally with different ports, override via environment variables
# ===========================================
gateway.services.member.host=${MEMBER_GRPC_HOST:localhost}
gateway.services.member.port=${MEMBER_GRPC_PORT:9090}
gateway.services.member.use-tls=false

gateway.services.catalog.host=${CATALOG_GRPC_HOST:localhost}
gateway.services.catalog.port=${CATALOG_GRPC_PORT:9091}
gateway.services.catalog.use-tls=false

gateway.services.cart.host=${CART_GRPC_HOST:localhost}
gateway.services.cart.port=${CART_GRPC_PORT:9092}
gateway.services.cart.use-tls=false

# ===========================================
# Public Paths (No authentication required)
# ===========================================
gateway.public-paths[0]=/health
gateway.public-paths[1]=/info
gateway.public-paths[2]=/routes
gateway.public-paths[3]=/services
gateway.public-paths[4]=/actuator/**
gateway.public-paths[5]=/swagger-ui/**
gateway.public-paths[6]=/api-docs/**
gateway.public-paths[7]=/v3/api-docs/**

# ===========================================
# Static Route Configuration (Fallback)
# These routes are used if services haven't registered dynamically
# Dynamic routes from database take precedence
# ===========================================

# User Routes (Member Service)
gateway.routes[0].path=/api/user/**
gateway.routes[0].service=member
gateway.routes[0].grpc-service=member.user.UserService
gateway.routes[0].public-route=false

gateway.routes[0].methods[0].http-method=POST
gateway.routes[0].methods[0].http-path=/api/user/register
gateway.routes[0].methods[0].grpc-method=Register
gateway.routes[0].methods[0].request-type=com.gdn.project.waroenk.member.CreateUserRequest
gateway.routes[0].methods[0].response-type=com.gdn.project.waroenk.member.CreateUserResponse
gateway.routes[0].methods[0].public-endpoint=true

gateway.routes[0].methods[1].http-method=POST
gateway.routes[0].methods[1].http-path=/api/user/login
gateway.routes[0].methods[1].grpc-method=Authenticate
gateway.routes[0].methods[1].request-type=com.gdn.project.waroenk.member.AuthenticateRequest
gateway.routes[0].methods[1].response-type=com.gdn.project.waroenk.member.UserTokenResponse
gateway.routes[0].methods[1].public-endpoint=true

gateway.routes[0].methods[2].http-method=GET
gateway.routes[0].methods[2].http-path=/api/user
gateway.routes[0].methods[2].grpc-method=GetOneUserById
gateway.routes[0].methods[2].request-type=com.gdn.project.waroenk.common.Id
gateway.routes[0].methods[2].response-type=com.gdn.project.waroenk.member.UserData

gateway.routes[0].methods[3].http-method=PUT
gateway.routes[0].methods[3].http-path=/api/user
gateway.routes[0].methods[3].grpc-method=UpdateUser
gateway.routes[0].methods[3].request-type=com.gdn.project.waroenk.member.UpdateUserRequest
gateway.routes[0].methods[3].response-type=com.gdn.project.waroenk.member.UserData

# Search Routes (Catalog Service) - Public
gateway.routes[1].path=/api/search/**
gateway.routes[1].service=catalog
gateway.routes[1].grpc-service=catalog.search.SearchService
gateway.routes[1].public-route=true

gateway.routes[1].methods[0].http-method=GET
gateway.routes[1].methods[0].http-path=/api/search
gateway.routes[1].methods[0].grpc-method=Search
gateway.routes[1].methods[0].request-type=com.gdn.project.waroenk.catalog.CombinedSearchRequest
gateway.routes[1].methods[0].response-type=com.gdn.project.waroenk.catalog.CombinedSearchResponse
gateway.routes[1].methods[0].public-endpoint=true

gateway.routes[1].methods[1].http-method=GET
gateway.routes[1].methods[1].http-path=/api/search/products
gateway.routes[1].methods[1].grpc-method=SearchProducts
gateway.routes[1].methods[1].request-type=com.gdn.project.waroenk.catalog.SearchProductsRequest
gateway.routes[1].methods[1].response-type=com.gdn.project.waroenk.catalog.SearchProductsResponse
gateway.routes[1].methods[1].public-endpoint=true

# Product Routes (Catalog Service)
gateway.routes[2].path=/api/product/**
gateway.routes[2].service=catalog
gateway.routes[2].grpc-service=catalog.product.ProductService
gateway.routes[2].public-route=false

gateway.routes[2].methods[0].http-method=GET
gateway.routes[2].methods[0].http-path=/api/product
gateway.routes[2].methods[0].grpc-method=FindProductById
gateway.routes[2].methods[0].request-type=com.gdn.project.waroenk.common.Id
gateway.routes[2].methods[0].response-type=com.gdn.project.waroenk.catalog.ProductData
gateway.routes[2].methods[0].public-endpoint=true

gateway.routes[2].methods[1].http-method=GET
gateway.routes[2].methods[1].http-path=/api/product/filter
gateway.routes[2].methods[1].grpc-method=FilterProduct
gateway.routes[2].methods[1].request-type=com.gdn.project.waroenk.catalog.FilterProductRequest
gateway.routes[2].methods[1].response-type=com.gdn.project.waroenk.catalog.MultipleProductResponse
gateway.routes[2].methods[1].public-endpoint=true

gateway.routes[2].methods[2].http-method=GET
gateway.routes[2].methods[2].http-path=/api/product/by-sku
gateway.routes[2].methods[2].grpc-method=FindProductBySku
gateway.routes[2].methods[2].request-type=com.gdn.project.waroenk.catalog.FindProductBySkuRequest
gateway.routes[2].methods[2].response-type=com.gdn.project.waroenk.catalog.ProductData
gateway.routes[2].methods[2].public-endpoint=true

gateway.routes[2].methods[3].http-method=GET
gateway.routes[2].methods[3].http-path=/api/product/details
gateway.routes[2].methods[3].grpc-method=GetProductDetails
gateway.routes[2].methods[3].request-type=com.gdn.project.waroenk.catalog.GetProductDetailsRequest
gateway.routes[2].methods[3].response-type=com.gdn.project.waroenk.catalog.GetProductDetailsResponse
gateway.routes[2].methods[3].public-endpoint=true

gateway.routes[2].methods[4].http-method=POST
gateway.routes[2].methods[4].http-path=/api/product/summary
gateway.routes[2].methods[4].grpc-method=GetProductSummary
gateway.routes[2].methods[4].request-type=com.gdn.project.waroenk.catalog.GetProductSummaryRequest
gateway.routes[2].methods[4].response-type=com.gdn.project.waroenk.catalog.GetProductSummaryResponse
gateway.routes[2].methods[4].public-endpoint=true

# Merchant Routes (Catalog Service)
gateway.routes[4].path=/api/merchant/**
gateway.routes[4].service=catalog
gateway.routes[4].grpc-service=catalog.merchant.MerchantService
gateway.routes[4].public-route=true

gateway.routes[4].methods[0].http-method=GET
gateway.routes[4].methods[0].http-path=/api/merchant
gateway.routes[4].methods[0].grpc-method=FindMerchantById
gateway.routes[4].methods[0].request-type=com.gdn.project.waroenk.common.Id
gateway.routes[4].methods[0].response-type=com.gdn.project.waroenk.catalog.MerchantData
gateway.routes[4].methods[0].public-endpoint=true

gateway.routes[4].methods[1].http-method=GET
gateway.routes[4].methods[1].http-path=/api/merchant/by-code
gateway.routes[4].methods[1].grpc-method=FindMerchantByCode
gateway.routes[4].methods[1].request-type=com.gdn.project.waroenk.catalog.FindMerchantByCodeRequest
gateway.routes[4].methods[1].response-type=com.gdn.project.waroenk.catalog.MerchantData
gateway.routes[4].methods[1].public-endpoint=true

gateway.routes[4].methods[2].http-method=GET
gateway.routes[4].methods[2].http-path=/api/merchant/filter
gateway.routes[4].methods[2].grpc-method=FilterMerchant
gateway.routes[4].methods[2].request-type=com.gdn.project.waroenk.catalog.FilterMerchantRequest
gateway.routes[4].methods[2].response-type=com.gdn.project.waroenk.catalog.MultipleMerchantResponse
gateway.routes[4].methods[2].public-endpoint=true

# Category Routes (Catalog Service)
gateway.routes[5].path=/api/category/**
gateway.routes[5].service=catalog
gateway.routes[5].grpc-service=catalog.category.CategoryService
gateway.routes[5].public-route=true

gateway.routes[5].methods[0].http-method=GET
gateway.routes[5].methods[0].http-path=/api/category/filter
gateway.routes[5].methods[0].grpc-method=FilterCategory
gateway.routes[5].methods[0].request-type=com.gdn.project.waroenk.catalog.FilterCategoryRequest
gateway.routes[5].methods[0].response-type=com.gdn.project.waroenk.catalog.MultipleCategoryResponse
gateway.routes[5].methods[0].public-endpoint=true

# Brand Routes (Catalog Service)
gateway.routes[7].path=/api/brand/**
gateway.routes[7].service=catalog
gateway.routes[7].grpc-service=catalog.brand.BrandService
gateway.routes[7].public-route=true

gateway.routes[7].methods[0].http-method=GET
gateway.routes[7].methods[0].http-path=/api/brand
gateway.routes[7].methods[0].grpc-method=FindBrandById
gateway.routes[7].methods[0].request-type=com.gdn.project.waroenk.common.Id
gateway.routes[7].methods[0].response-type=com.gdn.project.waroenk.catalog.BrandData
gateway.routes[7].methods[0].public-endpoint=true

gateway.routes[7].methods[1].http-method=GET
gateway.routes[7].methods[1].http-path=/api/brand/filter
gateway.routes[7].methods[1].grpc-method=FilterBrand
gateway.routes[7].methods[1].request-type=com.gdn.project.waroenk.catalog.FilterBrandRequest
gateway.routes[7].methods[1].response-type=com.gdn.project.waroenk.catalog.MultipleBrandResponse
gateway.routes[7].methods[1].public-endpoint=true

# Cart Routes (Cart Service)
gateway.routes[3].path=/api/cart/**
gateway.routes[3].service=cart
gateway.routes[3].grpc-service=cart.cart.CartService
gateway.routes[3].public-route=false

gateway.routes[3].methods[0].http-method=GET
gateway.routes[3].methods[0].http-path=/api/cart
gateway.routes[3].methods[0].grpc-method=GetCart
gateway.routes[3].methods[0].request-type=com.gdn.project.waroenk.cart.GetCartRequest
gateway.routes[3].methods[0].response-type=com.gdn.project.waroenk.cart.CartData

gateway.routes[3].methods[1].http-method=POST
gateway.routes[3].methods[1].http-path=/api/cart/add
gateway.routes[3].methods[1].grpc-method=AddItem
gateway.routes[3].methods[1].request-type=com.gdn.project.waroenk.cart.AddCartItemRequest
gateway.routes[3].methods[1].response-type=com.gdn.project.waroenk.cart.CartData

gateway.routes[3].methods[2].http-method=DELETE
gateway.routes[3].methods[2].http-path=/api/cart/clear
gateway.routes[3].methods[2].grpc-method=ClearCart
gateway.routes[3].methods[2].request-type=com.gdn.project.waroenk.cart.ClearCartRequest
gateway.routes[3].methods[2].response-type=com.gdn.project.waroenk.common.Basic

gateway.routes[3].methods[3].http-method=POST
gateway.routes[3].methods[3].http-path=/api/cart/bulk-add
gateway.routes[3].methods[3].grpc-method=BulkAddItems
gateway.routes[3].methods[3].request-type=com.gdn.project.waroenk.cart.BulkAddCartItemsRequest
gateway.routes[3].methods[3].response-type=com.gdn.project.waroenk.cart.CartData

gateway.routes[3].methods[4].http-method=POST
gateway.routes[3].methods[4].http-path=/api/cart/remove
gateway.routes[3].methods[4].grpc-method=RemoveItem
gateway.routes[3].methods[4].request-type=com.gdn.project.waroenk.cart.RemoveCartItemRequest
gateway.routes[3].methods[4].response-type=com.gdn.project.waroenk.cart.CartData

gateway.routes[3].methods[5].http-method=POST
gateway.routes[3].methods[5].http-path=/api/cart/bulk-remove
gateway.routes[3].methods[5].grpc-method=BulkRemoveItems
gateway.routes[3].methods[5].request-type=com.gdn.project.waroenk.cart.BulkRemoveCartItemsRequest
gateway.routes[3].methods[5].response-type=com.gdn.project.waroenk.cart.CartData

gateway.routes[3].methods[6].http-method=PUT
gateway.routes[3].methods[6].http-path=/api/cart/update
gateway.routes[3].methods[6].grpc-method=UpdateItem
gateway.routes[3].methods[6].request-type=com.gdn.project.waroenk.cart.UpdateCartItemRequest
gateway.routes[3].methods[6].response-type=com.gdn.project.waroenk.cart.CartData

# Checkout Routes (Cart Service - Checkout)
gateway.routes[6].path=/api/checkout/**
gateway.routes[6].service=cart
gateway.routes[6].grpc-service=cart.checkout.CheckoutService
gateway.routes[6].public-route=false

gateway.routes[6].methods[0].http-method=POST
gateway.routes[6].methods[0].http-path=/api/checkout/validate
gateway.routes[6].methods[0].grpc-method=ValidateAndReserve
gateway.routes[6].methods[0].request-type=com.gdn.project.waroenk.cart.ValidateCheckoutRequest
gateway.routes[6].methods[0].response-type=com.gdn.project.waroenk.cart.ValidateCheckoutResponse

gateway.routes[6].methods[1].http-method=GET
gateway.routes[6].methods[1].http-path=/api/checkout
gateway.routes[6].methods[1].grpc-method=GetCheckout
gateway.routes[6].methods[1].request-type=com.gdn.project.waroenk.cart.GetCheckoutRequest
gateway.routes[6].methods[1].response-type=com.gdn.project.waroenk.cart.CheckoutData

gateway.routes[6].methods[2].http-method=POST
gateway.routes[6].methods[2].http-path=/api/checkout/finalize
gateway.routes[6].methods[2].grpc-method=FinalizeCheckout
gateway.routes[6].methods[2].request-type=com.gdn.project.waroenk.cart.FinalizeCheckoutRequest
gateway.routes[6].methods[2].response-type=com.gdn.project.waroenk.cart.FinalizeCheckoutResponse

gateway.routes[6].methods[3].http-method=POST
gateway.routes[6].methods[3].http-path=/api/checkout/cancel
gateway.routes[6].methods[3].grpc-method=InvalidateCheckout
gateway.routes[6].methods[3].request-type=com.gdn.project.waroenk.cart.InvalidateCheckoutRequest
gateway.routes[6].methods[3].response-type=com.gdn.project.waroenk.common.Basic
